<div id="map"></div>
<script type="text/javascript">
var map;
function initMap() {
map = new google.maps.Map(document.getElementById('map'), {
center: {lat: 38, lng: 138},
zoom: 6
});

<% @images.each_with_index do |image,i| %>
var infowindow<%= i %> = new google.maps.InfoWindow({
    content: '<p><%= image.address %></p><%= image_tag @google_images.find{|item| item.id == image.google_id}.thumbnail_link %>'

});

var marker<%= i %> = new google.maps.Marker({
position: {lat: <%= image.latitude.to_f %>, lng: <%= image.longitude.to_f %>},
map: map,
title: '<%= image.address %>'
});

marker<%= i %>.addListener('click', function() {
    infowindow<%= i %>.open(map, marker<%= i %>);
});
<% end %>


}
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?callback=initMap">
</script>